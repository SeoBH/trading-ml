# Gemini Trading ML - 종합 프로젝트 설명서 (상세 최종판)

## 1. 프로젝트 개요 및 철학

### 1.1. 무엇을 하는 프로젝트인가?

이 프로젝트는 비트코인(BTCUSDT) 1분봉 가격 데이터와 구글 트렌드(Google Trends)의 검색량 데이터를 기반으로, 수익을 내는 매매 신호를 생성하는 자동화된 트레이딩 봇을 개발하고 운영하는 것을 목표로 합니다.

### 1.2. 핵심 철학: "살아있는 시스템"

시장은 계속 변하기 때문에, 한 번 만든 모델은 시간이 지나면 성능이 떨어집니다. 이 프로젝트의 핵심 철학은, 시장의 변화에 발맞춰 모델도 함께 진화하고 똑똑해지는 **'살아있는 시스템'**을 만드는 것입니다.

이를 위해, 단순히 모델을 한 번 만들고 끝내는 것이 아니라 **MLOps(Machine Learning Operations)** 개념을 도입하여, 새로운 데이터를 계속 학습하고, 기존 모델과 새로운 모델을 공정하게 경쟁(A/B 테스트)시켜 더 나은 모델을 자동으로 운영에 반영하는 **'지속적인 개선 파이프라인'**을 구축했습니다.

## 2. 프로젝트 폴더 구조

프로젝트는 아래와 같이 역할에 따라 명확하게 폴더가 분리되어 있어, 코드를 쉽게 찾고 관리할 수 있습니다.

```
C:\trading-ml\
├───.env                      # (환경 변수 설정 파일, 현재는 사용 안함)
├───GEMINI.md                  # (프로젝트 총괄 설명서, 현재 파일)
├───(각종 .ps1 파일)           # (각종 자동화 실행 스크립트)
│
├───src/                         # [핵심] 모든 파이썬 소스 코드가 있는 곳
│   ├───01_build_dataset.py    # 데이터셋 생성 로직
│   └───... (등등)
│
├───data/                        # [데이터] 원본, 가공, 외부 데이터 저장소
│   ├───binance/               # 바이낸스에서 받은 순수 1분봉 데이터
│   └───google_trends.csv      # 수집한 구글 트렌드 데이터
│
├───models/                      # [모델] 학습이 완료된 모델(.pkl) 파일 저장소
├───logs/                        # [로그] 운영 및 테스트 중 발생하는 모든 기록
├───config/                      # [설정] 현재 운영에 어떤 모델을 쓸지 정의하는 파일
└───backtest/                    # [결과] 백테스트 실행 결과 저장소
```

-   **`src/`**: 이 폴더에는 프로젝트의 모든 핵심 두뇌와 로직이 담긴 파이썬(`.py`) 파일들이 들어있습니다.
-   **`루트 폴더의 .ps1 파일들`**: `src` 폴더의 복잡한 파이썬 로직들을, 우리가 사용하기 쉬운 '원클릭 버튼'처럼 만들어주는 자동화 스크립트입니다.

## 3. 핵심 파이프라인 흐름도

이 프로젝트는 크게 **(1)초기 모델 개발**과 **(2)운영 및 지속적 개선**이라는 두 가지 단계로 구성되며, 2번 단계는 계속 순환합니다.

![Pipeline Diagram](https://i.imgur.com/your_diagram_image_url.png)  <-- 이 부분은 실제 이미지 URL로 대체해야 합니다.
(현재 텍스트 환경이라 다이어그램을 직접 그릴 수 없지만, 이전 대화의 다이어그램이 이 흐름을 나타냅니다.)

## 4. 단계별 실행 가이드

아래 순서대로 스크립트를 실행하면, 데이터 준비부터 모델 개선까지 전체 파이프라인을 경험할 수 있습니다.

---

### **[ 준비 단계 ] 데이터 수집 및 첫 모델 생성**

*이 단계는 새로운 데이터를 추가하거나, 피처 엔지니어링 로직을 바꾸지 않는 한 자주 실행할 필요는 없습니다.*

**1. (수동) 원본 데이터 준비**
   -   **[설명]** 모델 학습에 필요한 가장 기본적인 1분봉 가격 데이터를 준비합니다.
   -   **[작업]** `data/binance/` 폴더 안에 바이낸스에서 내려받은 월별 1분봉 데이터(`*.csv`)를 넣어주세요.

**2. 외부 데이터(구글 트렌드) 수집**
   -   **[설명]** 가격 외에, 시장의 관심도를 나타내는 구글 트렌드 데이터를 수집하여 `data` 폴더에 저장합니다. 이 데이터는 나중에 가격 데이터와 합쳐져 새로운 피처로 사용됩니다.
   -   **[실행]** 터미널에 `python .\src\fetch_trends_data.py` 입력
   -   **[결과]** `data/google_trends.csv` 파일 생성

**3. 학습 데이터셋 생성**
   -   **[설명]** 순수한 가격 데이터와 수집한 구글 트렌드 데이터를 합치고, RSI/MACD 같은 수십 개의 기술적 보조지표(피처)를 계산하여, 모델이 학습할 수 있는 거대한 '문제집+정답지' 파일을 만듭니다.
   -   **[실행]** 터미널에 `python .\src\01_build_dataset.py` 입력
   -   **[결과]** `data/dataset_1m_H60_with_trends.csv` 파일 생성

**4. 첫 모델(챔피언, A모델) 학습**
   -   **[설명]** 위에서 만든 '문제집+정답지'를 이용해, 앞으로 우리를 위해 일해 줄 첫 번째 AI 모델을 학습시킵니다.
   -   **[실행]** 터미널에 `python .\src\02_train_eval.py` 입력
   -   **[결과]** `models` 폴더에 `..._trends.pkl` 라는 이름의 모델 파일 생성. 이 모델이 우리의 첫 **챔피언(A) 모델**입니다.

---


### **[ 개선 단계 ] 새로운 모델(도전자) 생성 및 챔피언 교체**

*이 단계는 주기적으로 실행하여, 시장 변화에 적응하는 더 똑똑한 모델을 만들어내는 핵심 과정입니다.*

**5. 리플레이 로그 생성**
   -   **[설명]** 새로운 모델을 학습시키기 위한 재료를 만듭니다. 과거 데이터 전체를 대상으로, 마치 실시간처럼 매우 정밀한 거래 시뮬레이션을 실행하여 상세한 로그를 생성합니다. **(경고: 10시간 이상 소요될 수 있습니다!)**
   -   **[실행]** 터미널에 `.\run_replay_full.ps1` 입력
   -   **[결과]** `logs/replay/replay_full.csv` 파일 생성

**6. 재학습용 데이터 누적**
   -   **[설명]** 위에서 만든 리플레이 로그에 "실제 정답(미래 수익률)"을 달아, 영구적인 재학습 데이터 저장소에 차곡차곡 쌓습니다.
   -   **[실행]** 터미널에 `python .\src\05_label_and_append.py` 입력
   -   **[결과]** `data/training_store.parquet` 파일이 생성 또는 업데이트됨

**7. 새로운 모델(도전자, B모델) 재학습**
   -   **[설명]** 누적된 최신 데이터를 모두 사용하여, 현재 챔피언에게 도전할 새로운 AI 모델을 학습시킵니다.
   -   **[실행]** 터미널에 `python .\src\06_retrain_from_store.py` 입력
   -   **[결과]** `models` 폴더에 새로운 모델 파일(`..._2024...pkl`) 생성. 이 모델이 **도전자(B) 모델**입니다.

**8. A/B 테스트 준비 및 실행**
   -   **[설명]** 챔피언(A)과 도전자(B)를 공정하게 경쟁시키기 위한 환경을 설정하고, 두 모델을 동시에 실행하여 실시간 모의 투자를 진행합니다.
   -   **[작업]** `models` 폴더에서 모델 파일들을 `..._A.pkl`, `..._B.pkl`로 복사하고, `config` 폴더에 `..._A.json`, `..._B.json` 파일을 설정합니다.
   -   **[실행]** 터미널에 `.\start_ab_live.ps1` 입력 (새 창 2개 열림)
   -   **[종료]** 일정 시간 후, 열려있는 두 개의 창을 직접 닫습니다.

**9. A/B 테스트 결과 채점 및 승격**
   -   **[설명]** 두 모델이 남긴 거래 기록을 비교하여, 수익률이 더 높은 쪽을 승자로 결정하고, 이 승자를 새로운 챔피언으로 임명(Promote)합니다.
   -   **[실행 1]** 터미널에 `.\score_ab.ps1` 입력 (승자 결정)
   -   **[실행 2]** 터미널에 `.\promote_winner.ps1` 입력 (새로운 챔피언 임명)
   -   **[결과]** `config/active_models.json` 파일의 내용이 승자 모델의 경로로 자동 업데이트됨

**10. 새로운 챔피언으로 실전 투자 시작**
    -   **[설명]** 이제부터는 A/B 테스트에서 승리한, 더 똑똑해진 모델이 우리의 계좌를 위해 일하게 됩니다.
    -   **[실행]** 터미널에 `.\start_prod_live.ps1` 입력

위 과정을 주기적으로 반복하며, 우리는 시장을 이기는 강력한 트레이딩 봇을 함께 만들어 나갈 수 있습니다.
